# Signature
## Текст задания

Требуется написать консольную программу на C++ для генерации сигнатуры указанного файла.
Сигнатура генерируется следующим образом: исходный файл делится на блоки равной
(фиксированной) длины (если размер файла не кратен размеру блока, последний фрагмент может
быть меньше или дополнен нулями до размера полного блока). Для каждого блока вычисляется
значение hash функции и дописывается в выходной файл-сигнатуру. 

Интерфейс: командная строка, в которой указаны:
* Путь до входного файла
* Путь до выходной файла
* Размер блока (по умолчанию, 1 Мб)
  
Обязательные требования:
* Следует максимально оптимизировать скорость работы утилиты с учетом работы в
многопроцессорной среде
* Нужно реализовать правильную обработку ошибок на основе эксепшенов
* При работе с ресурсами нужно использовать умные указатели
* Не допускается использовать сторонние библиотеки OpenMP, OpenCL, etc
  
Допущения:
* Размер входного файла может быть много больше размера доступной физической памяти
(&gt; 4 Гб)
* Разрешается использовать boost
* В качестве хэш функции можно использовать любую хэш функцию (MD5, CRC и т.д.)

## Решение
Предлагаю следующее решение:
* Последовательно читаем файл блоками в основном потоке. 
* Каждый прочитанный блок вместе с его порядковым номером отправляем в потокобезопасную очередь. Номер блока нужен, чтобы сохранить порядок следования сигнатур в выходном файле.
* Для расчета хешей, как для самой ресурсоемкой с точки зрения CPU операции, используем пул потоков. Количество потоков в пуле делаем равным количеству доступных ядер минус 1.
* Размер потокобезопасной очереди ограничен сверху, поскольку, если потоки пула не будут успевать выбирать блоки из очереди, то при большом размере входного файла мы можем исчерпать всю доступную физическую память.
* Отдельные потоки пула читают отдельные блоки файла из потокобезопасной очереди, расчитывают для них хеш и помещают в потокобезопасную структуру, которая восстанавливает первоначальный порядок следования блоков.
* Посте того, как все блоки файла прочитаны и отправлены в очередь на обработку, основной поток дожидается завершения обработки блоков внутри пула и записывает полученную последовательность хешей (сигнатуру) в выходной файл.
* Для расчета хешей выбран алгоритм SHA1
## Требования
* cmake 3.5
* boost v1.66+
  * boost uuid (SHA1) - не требует сборки
  * boost unit_test_framework
## Особенности реализации
* Код проекта написан на стандартном C++17 и рассчитан на кроссплатформенное использование.
* Использовал boost 1.71
* Собирал проект на Visual Studio 2017 и на дынный момент тестировал данный код только на ОС Windows 10.
* Алгоритм SHA1 выбран просто потому, что он есть в boost.
## Сборка проекта
```
  mkdir mbuild && cd mbuild
  cmake ..
  cmake --build . --config Release
```